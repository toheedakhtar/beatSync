from flask import Flask, jsonify, request
from flask_cors import CORS
from sklearn.neighbors import NearestNeighbors
import pickle
import requests
from json import loads, dumps

app = Flask(__name__)
cors = CORS(app, origins='*')


normalized_data = pickle.load(open('knn_music_data.pkl', 'rb'))
df = pickle.load(open('df_data.pkl', 'rb'))


@app.route("/api/song", methods=['POST'])
def recommend():
    data = request.get_json()

    try:
        song_idx = df[df['Name'] == data['value']].index.tolist()[0]
        knn = NearestNeighbors(n_neighbors=13, algorithm='auto', metric='cosine') 
        knn.fit(normalized_data)
        distances, indices = knn.kneighbors([normalized_data[song_idx]])
        # print(f"Songs recommended for {df['Name'].iloc[song_idx]}")


        for index in indices:
            songs = (df['Name'].iloc[index].tolist())
        

        songs_dict_arr = []

        for song in songs:
            songs_dict = get_song_info(song)
            dict = {'song_name' : {song}}
            songs_dict.update(dict)
            # print(songs_dict)
            songs_dict_arr.append(songs_dict)

        try:
            songs_dict_arr = make_serializable(songs_dict_arr)
            json_data = dumps(songs_dict_arr)
            return json_data
        except:
            print('cant serialize')

    except:
        print('Error')
        return ['', 'There', 'is ', 'an', 'error']
    
# make the songs_dict_arr serializable to send to frontend as json
def make_serializable(obj):
    if isinstance(obj, set):  # Convert sets to lists
        return list(obj)
    elif isinstance(obj, dict):  # Process nested dictionaries
        return {k: make_serializable(v) for k, v in obj.items()}
    elif isinstance(obj, list):  # Process nested lists
        return [make_serializable(elem) for elem in obj]
    else:
        return obj


def get_song_info(song_name):
    url_data = requests.get(f'https://saavn.dev/api/search/songs?query={song_name}').json()
   
    # for testing
    json_data = '''{"success":true,"data":{"total":4,"start":-9,"results":[{"id":"imAwtsuz","name":"Genda Phool","type":"song","year":"2020","releaseDate":null,"duration":170,"label":"Sony Music Entertainment India Pvt. Ltd.","explicitContent":false,"playCount":199408650,"language":"hindi","hasLyrics":false,"lyricsId":null,"url":"https://www.jiosaavn.com/song/genda-phool/GQUqRgBDQkk","copyright":"(P) 2020 Sony Music Entertainment India Pvt. Ltd.","album":{"id":"19590662","name":"Genda Phool","url":"https://www.jiosaavn.com/album/genda-phool/rQSefq8q5PU_"},"artists":{"primary":[{"id":"456863","name":"Badshah","role":"primary_artists","image":[{"quality":"50x50","url":"https://c.saavncdn.com/artists/Badshah_005_20230608084021_50x50.jpg"},{"quality":"150x150","url":"https://c.saavncdn.com/artists/Badshah_005_20230608084021_150x150.jpg"},{"quality":"500x500","url":"https://c.saavncdn.com/artists/Badshah_005_20230608084021_500x500.jpg"}],"type":"artist","url":"https://www.jiosaavn.com/artist/badshah-songs/d4OwAaEcnD0_"}],"featured":[{"id":"653208","name":"Payal Dev","role":"featured_artists","image":[{"quality":"50x50","url":"https://c.saavncdn.com/artists/Payal_Dev_002_20241001094204_50x50.jpg"},{"quality":"150x150","url":"https://c.saavncdn.com/artists/Payal_Dev_002_20241001094204_150x150.jpg"},{"quality":"500x500","url":"https://c.saavncdn.com/artists/Payal_Dev_002_20241001094204_500x500.jpg"}],"type":"artist","url":"https://www.jiosaavn.com/artist/payal-dev-songs/szd0Qcak34Q_"}],"all":[{"id":"456863","name":"Badshah","role":"music","image":[{"quality":"50x50","url":"https://c.saavncdn.com/artists/Badshah_005_20230608084021_50x50.jpg"},{"quality":"150x150","url":"https://c.saavncdn.com/artists/Badshah_005_20230608084021_150x150.jpg"},{"quality":"500x500","url":"https://c.saavncdn.com/artists/Badshah_005_20230608084021_500x500.jpg"}],"type":"artist","url":"https://www.jiosaavn.com/artist/badshah-songs/d4OwAaEcnD0_"},{"id":"456863","name":"Badshah","role":"singer","image":[{"quality":"50x50","url":"https://c.saavncdn.com/artists/Badshah_005_20230608084021_50x50.jpg"},{"quality":"150x150","url":"https://c.saavncdn.com/artists/Badshah_005_20230608084021_150x150.jpg"},{"quality":"500x500","url":"https://c.saavncdn.com/artists/Badshah_005_20230608084021_500x500.jpg"}],"type":"artist","url":"https://www.jiosaavn.com/artist/badshah-songs/d4OwAaEcnD0_"},{"id":"653208","name":"Payal Dev","role":"singer","image":[{"quality":"50x50","url":"https://c.saavncdn.com/artists/Payal_Dev_002_20241001094204_50x50.jpg"},{"quality":"150x150","url":"https://c.saavncdn.com/artists/Payal_Dev_002_20241001094204_150x150.jpg"},{"quality":"500x500","url":"https://c.saavncdn.com/artists/Payal_Dev_002_20241001094204_500x500.jpg"}],"type":"artist","url":"https://www.jiosaavn.com/artist/payal-dev-songs/szd0Qcak34Q_"},{"id":"456863","name":"Badshah","role":"lyricist","image":[{"quality":"50x50","url":"https://c.saavncdn.com/artists/Badshah_005_20230608084021_50x50.jpg"},{"quality":"150x150","url":"https://c.saavncdn.com/artists/Badshah_005_20230608084021_150x150.jpg"},{"quality":"500x500","url":"https://c.saavncdn.com/artists/Badshah_005_20230608084021_500x500.jpg"}],"type":"artist","url":"https://www.jiosaavn.com/artist/badshah-songs/d4OwAaEcnD0_"},{"id":"456863","name":"Badshah","role":"starring","image":[{"quality":"50x50","url":"https://c.saavncdn.com/artists/Badshah_005_20230608084021_50x50.jpg"},{"quality":"150x150","url":"https://c.saavncdn.com/artists/Badshah_005_20230608084021_150x150.jpg"},{"quality":"500x500","url":"https://c.saavncdn.com/artists/Badshah_005_20230608084021_500x500.jpg"}],"type":"artist","url":"https://www.jiosaavn.com/artist/badshah-songs/d4OwAaEcnD0_"},{"id":"653208","name":"Payal Dev","role":"starring","image":[{"quality":"50x50","url":"https://c.saavncdn.com/artists/Payal_Dev_002_20241001094204_50x50.jpg"},{"quality":"150x150","url":"https://c.saavncdn.com/artists/Payal_Dev_002_20241001094204_150x150.jpg"},{"quality":"500x500","url":"https://c.saavncdn.com/artists/Payal_Dev_002_20241001094204_500x500.jpg"}],"type":"artist","url":"https://www.jiosaavn.com/artist/payal-dev-songs/szd0Qcak34Q_"},{"id":"480380","name":"Jacqueline Fernandez","role":"starring","image":[{"quality":"50x50","url":"https://c.saavncdn.com/artists/Jacqueline_Fernandez_002_20240318080639_50x50.jpg"},{"quality":"150x150","url":"https://c.saavncdn.com/artists/Jacqueline_Fernandez_002_20240318080639_150x150.jpg"},{"quality":"500x500","url":"https://c.saavncdn.com/artists/Jacqueline_Fernandez_002_20240318080639_500x500.jpg"}],"type":"artist","url":"https://www.jiosaavn.com/artist/jacqueline-fernandez-songs/yBC0pNDjJf8_"}]},"image":[{"quality":"50x50","url":"https://c.saavncdn.com/991/Genda-Phool-Hindi-2020-20200325120350-50x50.jpg"},{"quality":"150x150","url":"https://c.saavncdn.com/991/Genda-Phool-Hindi-2020-20200325120350-150x150.jpg"},{"quality":"500x500","url":"https://c.saavncdn.com/991/Genda-Phool-Hindi-2020-20200325120350-500x500.jpg"}],"downloadUrl":[{"quality":"12kbps","url":"https://aac.saavncdn.com/991/8efb3ed04260fdd52e5b42b06593ffe4_12.mp4"},{"quality":"48kbps","url":"https://aac.saavncdn.com/991/8efb3ed04260fdd52e5b42b06593ffe4_48.mp4"},{"quality":"96kbps","url":"https://aac.saavncdn.com/991/8efb3ed04260fdd52e5b42b06593ffe4_96.mp4"},{"quality":"160kbps","url":"https://aac.saavncdn.com/991/8efb3ed04260fdd52e5b42b06593ffe4_160.mp4"},{"quality":"320kbps","url":"https://aac.saavncdn.com/991/8efb3ed04260fdd52e5b42b06593ffe4_320.mp4"}]},{"id":"gB-h0S3g","name":"Genda Phool (Junkilla Remix)","type":"song","year":"2020","releaseDate":null,"duration":198,"label":"Sony Music Entertainment India Pvt. Ltd.","explicitContent":false,"playCount":2636265,"language":"hindi","hasLyrics":false,"lyricsId":null,"url":"https://www.jiosaavn.com/song/genda-phool-junkilla-remix/FypGWURjBFQ","copyright":"(P) 2020 Sony Music Entertainment India Pvt. Ltd.","album":{"id":"22539935","name":"Genda Phool (Junkilla Remix)","url":"https://www.jiosaavn.com/album/genda-phool-junkilla-remix/WHi,hTEJ2kM_"},"artists":{"primary":[{"id":"456863","name":"Badshah","role":"primary_artists","image":[{"quality":"50x50","url":"https://c.saavncdn.com/artists/Badshah_005_20230608084021_50x50.jpg"},{"quality":"150x150","url":"https://c.saavncdn.com/artists/Badshah_005_20230608084021_150x150.jpg"},{"quality":"500x500","url":"https://c.saavncdn.com/artists/Badshah_005_20230608084021_500x500.jpg"}],"type":"artist","url":"https://www.jiosaavn.com/artist/badshah-songs/d4OwAaEcnD0_"},{"id":"5921050","name":"Sokodomo","role":"primary_artists","image":[],"type":"artist","url":"https://www.jiosaavn.com/artist/sokodomo-songs/nsyRRitJoWU_"},{"id":"653208","name":"Payal Dev","role":"primary_artists","image":[{"quality":"50x50","url":"https://c.saavncdn.com/artists/Payal_Dev_002_20241001094204_50x50.jpg"},{"quality":"150x150","url":"https://c.saavncdn.com/artists/Payal_Dev_002_20241001094204_150x150.jpg"},{"quality":"500x500","url":"https://c.saavncdn.com/artists/Payal_Dev_002_20241001094204_500x500.jpg"}],"type":"artist","url":"https://www.jiosaavn.com/artist/payal-dev-songs/szd0Qcak34Q_"}],"featured":[],"all":[{"id":"456863","name":"Badshah","role":"music","image":[{"quality":"50x50","url":"https://c.saavncdn.com/artists/Badshah_005_20230608084021_50x50.jpg"},{"quality":"150x150","url":"https://c.saavncdn.com/artists/Badshah_005_20230608084021_150x150.jpg"},{"quality":"500x500","url":"https://c.saavncdn.com/artists/Badshah_005_20230608084021_500x500.jpg"}],"type":"artist","url":"https://www.jiosaavn.com/artist/badshah-songs/d4OwAaEcnD0_"},{"id":"5921050","name":"Sokodomo","role":"music","image":[],"type":"artist","url":"https://www.jiosaavn.com/artist/sokodomo-songs/nsyRRitJoWU_"},{"id":"456863","name":"Badshah","role":"singer","image":[{"quality":"50x50","url":"https://c.saavncdn.com/artists/Badshah_005_20230608084021_50x50.jpg"},{"quality":"150x150","url":"https://c.saavncdn.com/artists/Badshah_005_20230608084021_150x150.jpg"},{"quality":"500x500","url":"https://c.saavncdn.com/artists/Badshah_005_20230608084021_500x500.jpg"}],"type":"artist","url":"https://www.jiosaavn.com/artist/badshah-songs/d4OwAaEcnD0_"},{"id":"5921050","name":"Sokodomo","role":"singer","image":[],"type":"artist","url":"https://www.jiosaavn.com/artist/sokodomo-songs/nsyRRitJoWU_"},{"id":"653208","name":"Payal Dev","role":"singer","image":[{"quality":"50x50","url":"https://c.saavncdn.com/artists/Payal_Dev_002_20241001094204_50x50.jpg"},{"quality":"150x150","url":"https://c.saavncdn.com/artists/Payal_Dev_002_20241001094204_150x150.jpg"},{"quality":"500x500","url":"https://c.saavncdn.com/artists/Payal_Dev_002_20241001094204_500x500.jpg"}],"type":"artist","url":"https://www.jiosaavn.com/artist/payal-dev-songs/szd0Qcak34Q_"},{"id":"","name":"sokodomo","role":"singer","image":[],"type":"artist","url":"https://www.jiosaavn.com/artist/sokodomo-songs/"},{"id":"456863","name":"Badshah","role":"lyricist","image":[{"quality":"50x50","url":"https://c.saavncdn.com/artists/Badshah_005_20230608084021_50x50.jpg"},{"quality":"150x150","url":"https://c.saavncdn.com/artists/Badshah_005_20230608084021_150x150.jpg"},{"quality":"500x500","url":"https://c.saavncdn.com/artists/Badshah_005_20230608084021_500x500.jpg"}],"type":"artist","url":"https://www.jiosaavn.com/artist/badshah-songs/d4OwAaEcnD0_"},{"id":"5921050","name":"Sokodomo","role":"lyricist","image":[],"type":"artist","url":"https://www.jiosaavn.com/artist/sokodomo-songs/nsyRRitJoWU_"}]},"image":[{"quality":"50x50","url":"https://c.saavncdn.com/163/Genda-Phool-Junkilla-Remix--Hindi-2020-20200917183915-50x50.jpg"},{"quality":"150x150","url":"https://c.saavncdn.com/163/Genda-Phool-Junkilla-Remix--Hindi-2020-20200917183915-150x150.jpg"},{"quality":"500x500","url":"https://c.saavncdn.com/163/Genda-Phool-Junkilla-Remix--Hindi-2020-20200917183915-500x500.jpg"}],"downloadUrl":[{"quality":"12kbps","url":"https://aac.saavncdn.com/163/800c69df000ded0de678026004c6a696_12.mp4"},{"quality":"48kbps","url":"https://aac.saavncdn.com/163/800c69df000ded0de678026004c6a696_48.mp4"},{"quality":"96kbps","url":"https://aac.saavncdn.com/163/800c69df000ded0de678026004c6a696_96.mp4"},{"quality":"160kbps","url":"https://aac.saavncdn.com/163/800c69df000ded0de678026004c6a696_160.mp4"},{"quality":"320kbps","url":"https://aac.saavncdn.com/163/800c69df000ded0de678026004c6a696_320.mp4"}]},{"id":"trOHU7BM","name":"Genda Phool (Sped Up)","type":"song","year":"2024","releaseDate":null,"duration":137,"label":"Sony Music Entertainment India Pvt. Ltd.","explicitContent":false,"playCount":13377,"language":"hindi","hasLyrics":false,"lyricsId":null,"url":"https://www.jiosaavn.com/song/genda-phool-sped-up/BBokeSEHdX4","copyright":"(P) 2024 Sony Music Entertainment India Pvt. Ltd.","album":{"id":"52658913","name":"Genda Phool (Sped Up)","url":"https://www.jiosaavn.com/album/genda-phool-sped-up/nRjaeM3vygo_"},"artists":{"primary":[{"id":"456863","name":"Badshah","role":"primary_artists","image":[{"quality":"50x50","url":"https://c.saavncdn.com/artists/Badshah_005_20230608084021_50x50.jpg"},{"quality":"150x150","url":"https://c.saavncdn.com/artists/Badshah_005_20230608084021_150x150.jpg"},{"quality":"500x500","url":"https://c.saavncdn.com/artists/Badshah_005_20230608084021_500x500.jpg"}],"type":"artist","url":"https://www.jiosaavn.com/artist/badshah-songs/d4OwAaEcnD0_"},{"id":"653208","name":"Payal Dev","role":"primary_artists","image":[{"quality":"50x50","url":"https://c.saavncdn.com/artists/Payal_Dev_002_20241001094204_50x50.jpg"},{"quality":"150x150","url":"https://c.saavncdn.com/artists/Payal_Dev_002_20241001094204_150x150.jpg"},{"quality":"500x500","url":"https://c.saavncdn.com/artists/Payal_Dev_002_20241001094204_500x500.jpg"}],"type":"artist","url":"https://www.jiosaavn.com/artist/payal-dev-songs/szd0Qcak34Q_"},{"id":"18738180","name":"Bollywood Sped Up","role":"primary_artists","image":[],"type":"artist","url":"https://www.jiosaavn.com/artist/bollywood-sped-up-songs/xTfie5qdYz0_"}],"featured":[],"all":[{"id":"456863","name":"Badshah","role":"music","image":[{"quality":"50x50","url":"https://c.saavncdn.com/artists/Badshah_005_20230608084021_50x50.jpg"},{"quality":"150x150","url":"https://c.saavncdn.com/artists/Badshah_005_20230608084021_150x150.jpg"},{"quality":"500x500","url":"https://c.saavncdn.com/artists/Badshah_005_20230608084021_500x500.jpg"}],"type":"artist","url":"https://www.jiosaavn.com/artist/badshah-songs/d4OwAaEcnD0_"},{"id":"456863","name":"Badshah","role":"singer","image":[{"quality":"50x50","url":"https://c.saavncdn.com/artists/Badshah_005_20230608084021_50x50.jpg"},{"quality":"150x150","url":"https://c.saavncdn.com/artists/Badshah_005_20230608084021_150x150.jpg"},{"quality":"500x500","url":"https://c.saavncdn.com/artists/Badshah_005_20230608084021_500x500.jpg"}],"type":"artist","url":"https://www.jiosaavn.com/artist/badshah-songs/d4OwAaEcnD0_"},{"id":"653208","name":"Payal Dev","role":"singer","image":[{"quality":"50x50","url":"https://c.saavncdn.com/artists/Payal_Dev_002_20241001094204_50x50.jpg"},{"quality":"150x150","url":"https://c.saavncdn.com/artists/Payal_Dev_002_20241001094204_150x150.jpg"},{"quality":"500x500","url":"https://c.saavncdn.com/artists/Payal_Dev_002_20241001094204_500x500.jpg"}],"type":"artist","url":"https://www.jiosaavn.com/artist/payal-dev-songs/szd0Qcak34Q_"},{"id":"18738180","name":"Bollywood Sped Up","role":"singer","image":[],"type":"artist","url":"https://www.jiosaavn.com/artist/bollywood-sped-up-songs/xTfie5qdYz0_"},{"id":"19056991","name":"Badshah","role":"singer","image":[],"type":"artist","url":"https://www.jiosaavn.com/artist/badshah-songs/YLw8L2PQ3RQ_"},{"id":"","name":"Payal Dev &amp; Bollywood Sped Up","role":"singer","image":[],"type":"artist","url":"https://www.jiosaavn.com/artist/payal-dev-bollywood-sped-up-songs/"},{"id":"456863","name":"Badshah","role":"lyricist","image":[{"quality":"50x50","url":"https://c.saavncdn.com/artists/Badshah_005_20230608084021_50x50.jpg"},{"quality":"150x150","url":"https://c.saavncdn.com/artists/Badshah_005_20230608084021_150x150.jpg"},{"quality":"500x500","url":"https://c.saavncdn.com/artists/Badshah_005_20230608084021_500x500.jpg"}],"type":"artist","url":"https://www.jiosaavn.com/artist/badshah-songs/d4OwAaEcnD0_"}]},"image":[{"quality":"50x50","url":"https://c.saavncdn.com/753/Genda-Phool-Sped-Up-Hindi-2024-20240318225104-50x50.jpg"},{"quality":"150x150","url":"https://c.saavncdn.com/753/Genda-Phool-Sped-Up-Hindi-2024-20240318225104-150x150.jpg"},{"quality":"500x500","url":"https://c.saavncdn.com/753/Genda-Phool-Sped-Up-Hindi-2024-20240318225104-500x500.jpg"}],"downloadUrl":[{"quality":"12kbps","url":"https://aac.saavncdn.com/753/947d9d94087d7d612a0c3912e3c9366d_12.mp4"},{"quality":"48kbps","url":"https://aac.saavncdn.com/753/947d9d94087d7d612a0c3912e3c9366d_48.mp4"},{"quality":"96kbps","url":"https://aac.saavncdn.com/753/947d9d94087d7d612a0c3912e3c9366d_96.mp4"},{"quality":"160kbps","url":"https://aac.saavncdn.com/753/947d9d94087d7d612a0c3912e3c9366d_160.mp4"},{"quality":"320kbps","url":"https://aac.saavncdn.com/753/947d9d94087d7d612a0c3912e3c9366d_320.mp4"}]},{"id":"VYRDco_N","name":"Genda Phool","type":"song","year":"2020","releaseDate":null,"duration":168,"label":"Sony Music Entertainment India Pvt. Ltd.","explicitContent":false,"playCount":199397291,"language":"hindi","hasLyrics":false,"lyricsId":null,"url":"https://www.jiosaavn.com/song/genda-phool/JjE5dRdfaH0","copyright":"(P) 2020 Sony Music Entertainment India Pvt. Ltd.","album":{"id":"24091271","name":"#1 Trending Hits","url":"https://www.jiosaavn.com/album/1-trending-hits/3MFS0NjhkUA_"},"artists":{"primary":[{"id":"456863","name":"Badshah","role":"primary_artists","image":[{"quality":"50x50","url":"https://c.saavncdn.com/artists/Badshah_005_20230608084021_50x50.jpg"},{"quality":"150x150","url":"https://c.saavncdn.com/artists/Badshah_005_20230608084021_150x150.jpg"},{"quality":"500x500","url":"https://c.saavncdn.com/artists/Badshah_005_20230608084021_500x500.jpg"}],"type":"artist","url":"https://www.jiosaavn.com/artist/badshah-songs/d4OwAaEcnD0_"}],"featured":[{"id":"653208","name":"Payal Dev","role":"featured_artists","image":[{"quality":"50x50","url":"https://c.saavncdn.com/artists/Payal_Dev_002_20241001094204_50x50.jpg"},{"quality":"150x150","url":"https://c.saavncdn.com/artists/Payal_Dev_002_20241001094204_150x150.jpg"},{"quality":"500x500","url":"https://c.saavncdn.com/artists/Payal_Dev_002_20241001094204_500x500.jpg"}],"type":"artist","url":"https://www.jiosaavn.com/artist/payal-dev-songs/szd0Qcak34Q_"}],"all":[{"id":"456863","name":"Badshah","role":"music","image":[{"quality":"50x50","url":"https://c.saavncdn.com/artists/Badshah_005_20230608084021_50x50.jpg"},{"quality":"150x150","url":"https://c.saavncdn.com/artists/Badshah_005_20230608084021_150x150.jpg"},{"quality":"500x500","url":"https://c.saavncdn.com/artists/Badshah_005_20230608084021_500x500.jpg"}],"type":"artist","url":"https://www.jiosaavn.com/artist/badshah-songs/d4OwAaEcnD0_"},{"id":"456863","name":"Badshah","role":"singer","image":[{"quality":"50x50","url":"https://c.saavncdn.com/artists/Badshah_005_20230608084021_50x50.jpg"},{"quality":"150x150","url":"https://c.saavncdn.com/artists/Badshah_005_20230608084021_150x150.jpg"},{"quality":"500x500","url":"https://c.saavncdn.com/artists/Badshah_005_20230608084021_500x500.jpg"}],"type":"artist","url":"https://www.jiosaavn.com/artist/badshah-songs/d4OwAaEcnD0_"},{"id":"653208","name":"Payal Dev","role":"singer","image":[{"quality":"50x50","url":"https://c.saavncdn.com/artists/Payal_Dev_002_20241001094204_50x50.jpg"},{"quality":"150x150","url":"https://c.saavncdn.com/artists/Payal_Dev_002_20241001094204_150x150.jpg"},{"quality":"500x500","url":"https://c.saavncdn.com/artists/Payal_Dev_002_20241001094204_500x500.jpg"}],"type":"artist","url":"https://www.jiosaavn.com/artist/payal-dev-songs/szd0Qcak34Q_"},{"id":"456863","name":"Badshah","role":"lyricist","image":[{"quality":"50x50","url":"https://c.saavncdn.com/artists/Badshah_005_20230608084021_50x50.jpg"},{"quality":"150x150","url":"https://c.saavncdn.com/artists/Badshah_005_20230608084021_150x150.jpg"},{"quality":"500x500","url":"https://c.saavncdn.com/artists/Badshah_005_20230608084021_500x500.jpg"}],"type":"artist","url":"https://www.jiosaavn.com/artist/badshah-songs/d4OwAaEcnD0_"},{"id":"456863","name":"Badshah","role":"starring","image":[{"quality":"50x50","url":"https://c.saavncdn.com/artists/Badshah_005_20230608084021_50x50.jpg"},{"quality":"150x150","url":"https://c.saavncdn.com/artists/Badshah_005_20230608084021_150x150.jpg"},{"quality":"500x500","url":"https://c.saavncdn.com/artists/Badshah_005_20230608084021_500x500.jpg"}],"type":"artist","url":"https://www.jiosaavn.com/artist/badshah-songs/d4OwAaEcnD0_"},{"id":"653208","name":"Payal Dev","role":"starring","image":[{"quality":"50x50","url":"https://c.saavncdn.com/artists/Payal_Dev_002_20241001094204_50x50"},{"quality":"150x150","url":"https://c.saavncdn.com/artists/Payal_Dev_002_20241001094204_150x150.jpg"},{"quality":"500x500","url":"https://c.saavncdn.com/artists/Payal_Dev_002_20241001094204_500x500.jpg"}],"type":"artist","url":"https://www.jiosaavn.com/artist/payal-dev-songs/szd0Qcak34Q_"},{"id":"480380","name":"Jacqueline Fernandez","role":"starring","image":[{"quality":"50x50","url":"https://c.saavncdn.com/artists/Jacqueline_Fernandez_002_20240318080639_50x50.jpg"},{"quality":"150x150","url":"https://c.saavncdn.com/artists/Jacqueline_Fernandez_002_20240318080639_150x150.jpg"},{"quality":"500x500","url":"https://c.saavncdn.com/artists/Jacqueline_Fernandez_002_20240318080639_500x500.jpg"}],"type":"artist","url":"https://www.jiosaavn.com/artist/jacqueline-fernandez-songs/yBC0pNDjJf8_"}]},"image":[{"quality":"50x50","url":"https://c.saavncdn.com/723/1-Trending-Hits-Hindi-2020-20201217204310-50x50.jpg"},{"quality":"150x150","url":"https://c.saavncdn.com/723/1-Trending-Hits-Hindi-2020-20201217204310-150x150.jpg"},{"quality":"500x500","url":"https://c.saavncdn.com/723/1-Trending-Hits-Hindi-2020-20201217204310-500x500.jpg"}],"downloadUrl":[{"quality":"12kbps","url":"https://aac.saavncdn.com/723/dc530f857f8acc600da9f23cf2ad0972_12.mp4"},{"quality":"48kbps","url":"https://aac.saavncdn.com/723/dc530f857f8acc600da9f23cf2ad0972_48.mp4"},{"quality":"96kbps","url":"https://aac.saavncdn.com/723/dc530f857f8acc600da9f23cf2ad0972_96.mp4"},{"quality":"160kbps","url":"https://aac.saavncdn.com/723/dc530f857f8acc600da9f23cf2ad0972_160.mp4"},{"quality":"320kbps","url":"https://aac.saavncdn.com/723/dc530f857f8acc600da9f23cf2ad0972_320.mp4"}]}]}}'''

    # url_data = loads(json_data)
    # if(url_data['success'] == True)
    try:
        song_url = url_data['data']['results'][0]['url']
        image_url = url_data['data']['results'][0]['image'][2]['url']
        album_name = url_data['data']['results'][0]['album']['name']
        artist = url_data['data']['results'][0]['artists']['primary'][0]['name']
        year = url_data['data']['results'][0]['year']
        label = url_data['data']['results'][0]['label']
        download_url = url_data['data']['results'][0]['downloadUrl'][-1]['url']

        song_dict = {
            'song_url' : song_url,
            'image_url' : image_url,
            'album_name' : album_name,
            'artist' : artist,
            'year' : year,
            'label' : label,
            'download_url' : download_url
        }
        return song_dict
    except:
        return {'error' : 'This is an error'}
        



if __name__ == '__main__':
    app.run(debug=True, port=8000)